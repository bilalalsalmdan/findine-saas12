generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Restaurant {
  id                String    @id @default(uuid())
  name              String
  slug              String    @unique
  email             String    @unique
  subscriptionTier  String    @default("free") // free, growth, pro, enterprise
  subscriptionStatus String   @default("trial") // trial, active, cancelled
  settings          Json?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  users     User[]
  menus     Menu[]
  orders    Order[]
  staff     StaffMember[]

  @@map("restaurants")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  firstName     String?
  lastName      String?
  role          String    @default("owner") // owner, manager, staff
  isActive      Boolean   @default(true)
  lastLoginAt   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  restaurant    Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  restaurantId  String

  @@map("users")
}

model StaffMember {
  id          String    @id @default(uuid())
  name        String
  email       String?
  phone       String?
  role        String    @default("staff") // staff, manager
  pinCode     String?   // For POS login
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  restaurant    Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  restaurantId  String

  @@map("staff_members")
}

model Menu {
  id          String    @id @default(uuid())
  name        String
  description String?
  isActive    Boolean   @default(true)
  qrCodeUrl   String?
  settings    Json?     // Colors, fonts, layout config
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  restaurant    Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  restaurantId  String
  categories    Category[]

  @@map("menus")
}

model Category {
  id          String    @id @default(uuid())
  nameAr      String
  nameEn      String?
  description String?
  sortOrder   Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  menu          Menu     @relation(fields: [menuId], references: [id], onDelete: Cascade)
  menuId        String
  dishes        Dish[]

  @@map("categories")
}

model Dish {
  id           String    @id @default(uuid())
  name         String
  description  String?
  price        Decimal   @db.Decimal(10, 2)
  currency     String    @default("SAR")
  imageUrl     String?
  isActive     Boolean   @default(true)
  isAvailable  Boolean   @default(true)
  allergens    String[]  // Array of allergens
  calories     Int?
  prepTime     Int?      // In minutes
  sortOrder    Int       @default(0)
  settings     Json?     // Spicy level, options, etc.
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  category      Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId    String

  @@map("dishes")
}

model Order {
  id          String    @id @default(uuid())
  orderNumber String    @unique
  status      String    @default("pending") // pending, preparing, ready, served, cancelled
  orderType   String    @default("dine_in") // dine_in, takeaway, delivery
  tableNumber String?
  customerName String?
  customerPhone String?
  totalAmount Decimal   @db.Decimal(10, 2)
  taxAmount   Decimal   @db.Decimal(10, 2) @default(0)
  discount    Decimal   @db.Decimal(10, 2) @default(0)
  finalAmount Decimal   @db.Decimal(10, 2)
  currency    String    @default("SAR")
  notes       String?
  paymentStatus String  @default("pending") // pending, paid, refunded
  paymentMethod String? // cash, card, online
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  restaurant    Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  restaurantId  String
  items         OrderItem[]

  @@map("orders")
}

model OrderItem {
  id        String    @id @default(uuid())
  dishName  String    // Snapshot of dish name at order time
  quantity  Int
  unitPrice Decimal   @db.Decimal(10, 2)
  totalPrice Decimal  @db.Decimal(10, 2)
  notes     String?
  createdAt DateTime  @default(now())

  // Relations
  order     Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId   String

  @@map("order_items")
}
